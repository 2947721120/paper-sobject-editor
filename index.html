<!doctype html>
<!--
Copyright 2013 The Polymer Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<html>
<head>
	<meta name="viewport" content="width=device-width, user-scalable=no">

	<!-- Platform polyfill import -->
	<script src="dependencies/platform/platform.js"></script>

	<!-- Local Browser Testing. Mocked cordova and Smartstore -->
	<script src="dependencies/mobilesdk-shared/test/MockCordova.js"></script>
	<script src="dependencies/mobilesdk-shared/libs/cordova.force.js"></script>
	<script src="dependencies/mobilesdk-shared/test/MockSmartStore.js"></script>
	<!-- End Local Testing -->


	<!-- Core Polymer Elements -->
	<link href="dependencies/core-icons/core-icons.html" rel="import">
	<link href="dependencies/core-animated-pages/core-animated-pages.html" rel="import">
	<link href="dependencies/core-animated-pages/transitions/slide-from-right.html" rel="import">
	<link href="dependencies/core-scroll-header-panel/core-scroll-header-panel.html" rel="import">
	<link href="dependencies/core-toolbar/core-toolbar.html" rel="import">

	<!-- Paper Elements -->
	<link href="dependencies/paper-item/paper-item.html" rel="import">
	<link href="dependencies/paper-shadow/paper-shadow.html" rel="import">
	<link href="dependencies/paper-menu-button/paper-menu-button.html" rel="import">
	<link href="dependencies/paper-input/paper-input.html" rel="import">
	<link href="dependencies/paper-checkbox/paper-checkbox.html" rel="import">
	
	
	<!-- Mobile UI Elements -->
	<link rel="import" href="elements/force-ui-app/force-ui-app.html">
	<link rel="import" href="elements/force-ui-search/force-ui-search.html">
	<link rel="import" href="elements/force-sobject-collection/force-sobject-collection.html">
	<link rel="import" href="elements/force-route/force-route.html">

	<!-- Account Editor Polymer Elements -->
	<link rel="import" href="elements-AE/force-paper-detail.html">
	<link rel="import" href="elements-AE/search-screen.html">
	<link rel="import" href="elements-AE/sync-screen.html">
	<link rel="import" href="elements-AE/detail-screen.html">
	<link rel="import" href="elements-AE/status-icon.html">


  	<style shim-shadowdom>
	    body {
	      margin: 0;
	      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
	      font-size: 14px;
	    }
  	</style>
</head>

<body unresolved>

    <polymer-element name="mobile-app" attributes="sobject searchfields displayfields">
      <template>

        <style>
        	core-animated-pages {
        		position: absolute;
        		top: 0; bottom: 0;
        		left: 0; right: 0;
        	}
          	core-animated-pages#pages > * {
            	-webkit-transition-duration: 0.5s;
            	transition-duration: 0.5s;
          	}
        </style>

        <core-animated-pages id="pages" transitions="['slide-from-right']" on-save="{{refresh}}" on-destroy="{{refresh}}" style="overflow-x:hidden">

          <search-screen id="listview" path="" sobject="{{sobject}}" searchfields="{{searchfields}}" fieldstofetch="{{displayfields}}" on-route-changed="{{showList}}">
            <template>
                <a href="#edit/{{id}}" style="text-decoration: none; color: inherit">
                  <div style="line-height: 20px; padding: 10px; border-bottom: 1px solid rgb(221, 221, 221);">
                    <div horizontal layout>
                      <img class="profile-photo" src="images/{{attributes.Photo__c || 'empty.jpeg'}}" style="height: 50px;width: 50px;border-radius: 50%;"/> 
                      <div layout vertical center-justified flex>
                        <div style="margin-left: 10px" layout horizontal>
                            <div flex>
                              <div style="font-size: 1.1em;">{{attributes.FirstName}} {{attributes.LastName}}</div>
                              <span style="font-size: 0.9em; color: #696969">{{attributes.Title}}</span>
                            </div>
                            <status-icon props="{{attributes}}"></status-icon>
                            <core-icon icon="chevron-right" style="fill: black"></core-icon>
                        </div>
                    </div>
                    </div>
                  </div>
                </a>
            </template>
          </search-screen>

          <sync-screen id="syncview" path="sync" sobject="{{sobject}}" on-route-changed="{{showSync}}" on-sync="{{resetConnection}}"></sync-screen>

          <detail-screen id="detail" sobject="{{sobject}}" path="edit(/:recordid)(/:sync)" on-route-changed="{{showDetail}}"></detail-screen>

        </core-animated-pages>

        <core-icon id="network_icon" icon="{{cloudicon}}" size="60" style="position: fixed; bottom: 0; right: 0; margin: 10px; fill: green" on-tap="{{toggleConnection}}"></core-icon>

      </template>

      <script>
        Polymer('mobile-app', {
          _onlineStatus: true,
          cloudicon: 'cloud-done',
          ready: function() {
            SFDC.isOnline = function() {
              return this._onlineStatus && !this.$.syncview.hasLocalChanges();
            }.bind(this);
          },
          get onlinestatus() {
            return this._onlineStatus;
          },
          set onlinestatus(newStatus) {
            this._onlineStatus = newStatus;
            this.cloudicon = newStatus ? "cloud-done" : "cloud-off";
            this.$.network_icon.style.fill = newStatus ? 'green' : 'red';
          },
          refresh: function() {
          	this.$.listview.refresh();
          	this.$.syncview.refresh();
          },
          toggleConnection: function() {
          	if (this.$.pages.selected == 0) {
	            this.onlinestatus = !this.onlinestatus;
	            if (this.onlinestatus) {
	            	window.location.hash = "#sync";
	            } else this.resetConnection();
	        }
          },
          resetConnection: function() {
          	this.$.listview.updateConnection();
          },
          showList: function(ev) {
            this.$.pages.selected = 0;
          },
          showSync: function(ev) {
            this.$.pages.selected = 1;
          },
          showDetail: function(ev) {
            this.$.pages.selected = 2;
          }
        })
      </script>

    </polymer-element>

    <mobile-app sobject="Contact" searchfields="FirstName LastName Photo__c" displayfields="Title"></mobile-app>

    <script src="elements-AE/forcetk.ui.js"></script>

    <script type="text/javascript">
      	window.addEventListener('WebComponentsReady', function() {
          	var creds = {
            	accessToken: '00Do0000000J3Ct!AQ0AQLgYNj8NEu6Rx.FbuKOPUq8KUObtF9W3v.p.qbS695byOiriE6353V3dqVzO.DeXdwOONaYoS3yuuQTj8IavwIkSZJ0M',
              instanceUrl: 'https://na17.salesforce.com'
          	};

            // Salesforce login URL
            var loginURL = 'https://login.salesforce.com/',
              // Consumer Key from Setup | Develop | Remote Access
              consumerKey = '3MVG9QDx8IX8nP5TwrwtRg53zXgJ3uh1Ggo9wNaAwMyRnRr8ukHN.gAI.kYEOu7rWc1f0NwEEUl5_qnI1EK7l',
              // Callback URL from Setup | Develop | Remote Access
              callbackURL = 'http://localhost:9000/oauth/success';

            // Instantiating forcetk ClientUI
            var oauthClient = new ForceOAuth(loginURL, consumerKey, callbackURL,
                              function forceOAuthUI_successHandler(forcetkClient) { // successCallback
                                  console.log('OAuth success!');
                                  creds = {
                                    accessToken: oauthClient.oauthResponse.access_token,
                                    instanceUrl: oauthClient.oauthResponse.instance_url
                                  };
                                  SFDC.launch(creds);
                              },

                              function forceOAuthUI_errorHandler(error) { // errorCallback
                                  console.log('OAuth error!');
                                  oauthClient.login();
                              });

          	Backbone.history.start();

          	if (location.protocol == 'file:') SFDC.launch(creds);
            else oauthClient.login();
      	});
        window.location.hash = '';
    </script>

</body>
</html>
